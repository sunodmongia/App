{% extends 'base.html' %}
{% block content %}

<div class="p-6 bg-gray-100">

<h1 class="text-3xl font-bold mb-4">SaaS Control Panel</h1>

<!-- DATE FILTER -->
<form method="get" class="flex gap-3 mb-6">
    <select name="days" class="border px-3 py-2 rounded">
        <option value="7"  {% if days == 7 %}selected{% endif %}>Last 7 days</option>
        <option value="30" {% if days == 30 %}selected{% endif %}>Last 30 days</option>
        <option value="90" {% if days == 90 %}selected{% endif %}>Last 90 days</option>
        <option value="365" {% if days == 365 %}selected{% endif %}>Last 1 year</option>
    </select>
    <button class="bg-black text-white px-4 py-2 rounded">Apply</button>
</form>

<!-- KPI GRID -->
<div class="grid grid-cols-6 gap-4 mb-8">

    <div class="bg-white p-4 rounded shadow">
        <p class="text-gray-500">Active Orgs</p>
        <p class="text-2xl font-bold">{{ active_orgs }}</p>
    </div>

    <div class="bg-white p-4 rounded shadow">
        <p class="text-gray-500">Revenue</p>
        <p class="text-2xl font-bold">₹{{ total_revenue }}</p>
    </div>

    <div class="bg-white p-4 rounded shadow">
        <p class="text-gray-500">API Calls</p>
        <p class="text-2xl font-bold">{{ total_api }}</p>
    </div>

    <div class="bg-white p-4 rounded shadow">
        <p class="text-gray-500">Automations</p>
        <p class="text-2xl font-bold">{{ total_automations }}</p>
    </div>

    <div class="bg-white p-4 rounded shadow">
        <p class="text-gray-500">Reports</p>
        <p class="text-2xl font-bold">{{ total_reports }}</p>
    </div>

    <div class="bg-white p-4 rounded shadow">
        <p class="text-gray-500">Storage (MB)</p>
        <p class="text-2xl font-bold">{{ total_storage }}</p>
    </div>

</div>

<!-- TOP ORGS -->
<div class="bg-white p-6 rounded shadow mb-8">
    <h2 class="text-xl font-bold mb-4">Top Organizations</h2>
    <table class="w-full text-left">
        <tr class="border-b">
            <th>Org</th>
            <th>Revenue</th>
            <th>API Calls</th>
            <th>Team</th>
            <th>Automations</th>
        </tr>
        {% for org in top_orgs %}
        <tr class="border-b">
            <td>{{ org.name }}</td>
            <td>₹{{ org.revenue|default:"0" }}</td>
            <td>{{ org.api_calls|default:"0" }}</td>
            <td>{{ org.team_size }}</td>
            <td>{{ org.automations }}</td>
        </tr>
        {% endfor %}
    </table>
</div>

<!-- EVENTS -->
<div class="bg-white p-6 rounded shadow mb-8">
    <h2 class="text-xl font-bold mb-4">Events (Last {{ days }} Days)</h2>
    <table class="w-full">
        <tr><th>Type</th><th>Count</th></tr>
        {% for e in events %}
        <tr>
            <td>{{ e.type }}</td>
            <td>{{ e.count }}</td>
        </tr>
        {% endfor %}
    </table>
</div>

<!-- AUTOMATION HEALTH -->
<div class="bg-white p-6 rounded shadow mb-8">
    <h2 class="text-xl font-bold mb-4">Automation Health</h2>
    <table class="w-full">
        <tr><th>Org</th><th>Total</th><th>Enabled</th></tr>
        {% for a in automation_stats %}
        <tr>
            <td>{{ a.org__name }}</td>
            <td>{{ a.total }}</td>
            <td>{{ a.enabled }}</td>
        </tr>
        {% endfor %}
    </table>
</div>

<!-- INACTIVE ORGS (CHURN RISK) -->
<div class="bg-white p-6 rounded shadow">
    <h2 class="text-xl font-bold mb-4 text-red-600">Inactive Organizations</h2>
    <table class="w-full">
        <tr><th>Org</th><th>Last Activity</th></tr>
        {% for org in inactive_orgs %}
        <tr>
            <td>{{ org.name }}</td>
            <td>{{ org.last_event|date:"Y-m-d" }}</td>
        </tr>
        {% endfor %}
    </table>
</div>

</div>
{% endblock %}
